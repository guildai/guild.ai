tags: concept

# Dependencies

[TOC]

## Overview

A *dependency* is a file or other resource required by an
operation. Dependencies are declared for an operation in a Guild file
using the `requires` attribute.

Here's an example of a required *file* dependency:

``` yaml
train:
  requires:
    - file: data.csv
```

When Guild runs an operation, it *resolves* each required
dependency. Dependency resolution is specific to each dependency
type. File dependencies, for example, are resolved by creating links
to required files.

For example, when Guild runs `train` above it resolves the required
file `data.csv` as follows:

- Guild looks for `data.csv` relative to the Guild file location.
- If Guild finds `data.csv` it creates a symbolic link named
  `data.csv` in the [run directory](term:run-dir).
- Otherwise Guild exits with an error message.

Use dependencies to ensure that an operation has what it needs to run.

## Declare Dependencies

Use the `requires` operation attribute to declare that the operation
requires a resource.

A resource declaration may be one of two types:

- Resource name
- Inline resource definition

Resource *names* must refer to a top-level resource definition in a
[full format](ref:full-format) Guild file. See [Define
Resources](#define-resources) below to details on defining a resource.

``` yaml
- operations:
    train:
      requires:
       - data
  resources:
    data:
     - file: data.csv
```

^ Sample operation using a *named resource* --- requires a full format
  Guild file

A resource may alternatively be defined *inline* using the resource
format described [below](#define-resources).


``` yaml
train:
  requires:
    - file: data.csv
```

Use named resources when more than one operation requires the same
resource, or simply to consolidate resource definitions. Otherwise use
inline resources.

## Define Resources

A resource is an object that is identified by a resource type
attribute. Refer to [*Resources
Reference*](/reference/guildfile.md#resources) for supported resource
types and their attributes.

A named resource may be defined for a model as an attribute of model
`resources`.

``` yaml
- model: mnist
  operations:
    train:
      requires: data
  resources:
    data:
     - file: data.csv
```

## Sharing Resources Across Models

Use `config` objects and inheritance to share resource definitions
across models.

Example:

``` yaml
- config: shared-resources
  resources:
    data:
     - file: data.csv
    prepared-data:
     - operation: prepare-data
       select: data.csv
```

## Resource Types

Guild supports a number of resource types, which are described
below. Refer to [Resources
Reference](/reference/guildfile.md#resources) for a full specification
of each type.

### Files

The most common required resource is a *file*. Guild supports
different ways to reference files:

- Path relative to the project directory
- URL
- Operation responsible for generating the file

In some cases, Guild resolves multiple files:

- Path or URL refers to an *archive* (e.g. a file ending in `zip`,
  `tar`, etc.) which Guild unpacks unless `unpack` is set to `no`
- Operation that generates more than one file

In such cases, you may use `select` to limit the resolved files to
those matching a pattern.

When resolving *operation* files, Guild first selects a suitable run
based on the operation name. Guild uses the following rules when
selecting a run, in the order listed:

1. User specified run ID for the resource name
2. Latest marked non-error run matching `operation`
2. Latest unmarked non-error run matching `operation`

Resolved resource links may be renamed using `rename`. This is useful
when a script expects a different path.

Examples:

``` yaml
train:
  requires:
   - file: data.csv
```

^ Sample operation that requires `data.csv` located in the project
  directory

``` yaml
train:
  requires:
    - url: https://my.co/data.csv
```

^ Sample operation that requires `data.csv` located by a URL

``` yaml
train:
  requires:
   - operation: prepare-data
     select: data.csv
```

^ Sample operation that requires `data.csv` generated by the
`prepare-data` operation

``` yaml
train:
  requires:
    - file: train-data.csv
      rename: train-data.csv data.csv
```

^ Sample operation that requires `data.csv` located in the project
  directory as `train-data.csv`

For more examples, see [Guildfile
Cheatsheet](/cheatsheets/guildfile.md#resources).

### Modules

An operation may require a particular software library, or
*module*. Required modules are defined using the `module` type
attribute.

``` yaml
train:
  requires:
   - module: pandas
   - module: keras
```

^ Sample operation that requires two Python modules: `pandas` and
  `keras`

Guild resolves required modules by verifying they are installed in
current environment. If Guild cannot verify a module, it exits with an
error message.

!!! important
    Guild does not *install* modules defined for `requires`
    --- it merely *verifies* that the modules are available. Ensure
    that required modules are installed in the environment before
    running the operation.

Use a required module to preemptly verify that the module is available
before starting the script.

### Configuration
