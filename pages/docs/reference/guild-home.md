tags: reference

# Guild home

[TOC]

Guild home is a directory that Guild AI uses to store various files.

Every Guild command is associated with a Guild home. If Guild home
does not exist, Guild will automatically create it.

By default, Guild home is one of two locations depending on whether or
not a command is run in a virtual environment.

If the command is not run in a virtual environment, Guild home is
`~/.guild` by default. If the command is run in a virtual environment,
Guild home is `$VIRTUAL_ENV/.guild` where `$VIRTUAL_ENV` is the
virtual environment directory.

Guild home may be set explicitly by either defining the environment
variable `GUILD_HOME` or by using the ``-H`` option when running a
Guild command.

## Layout

Guild home is structured as follows:

<div class="file-tree">
<ul>
<li class="is-folder open">Guild home<i>E.g. <strong>~/.guild</strong> or <strong>$VIRTUAL_ENV/.guild</strong></i>
<li class="is-folder open">cache <i>Caches used to optimize various Guild functions</i>
 <ul>
 <li class="is-folder">resources <i>Cached resources</i></li>
 <li class="is-folder">runs <i>Indexed run data</i></li>
 </ul>
</li>
<li class="is-folder">runs <i>Active runs</i></li>
<li class="is-folder">trash <i>Deleted runs</i></li>
</ul>
</div>

## Runs

Active runs (i.e. non-deleted runs) are stored in
`$GUILD_HOME/runs`. Each run is stored in a subdirectory with the same
name as the run ID.

Run directories contain all files associated with a run, including:

- Resource source links
- Output generated during the run
- Guild metadata

Guild metadata is stored in a subdirectory named `.guild` in each run
directory.

### Guild metadata

<div class="file-tree">
<ul>
<li class="is-folder open">Run directory
<li class="is-folder open">.guild <i>Guild metadata</i>
 <ul>
 <li class="is-file">output <i>Output generated by the run OS process</i></li>
 <li class="is-file">output.index <i>Timestamp and stream information associated with run output</i></li>
 <li class="is-folder open">attrs <i>Run attributes</i>
   <ul>
     <li class="is-file">cmd <i>Run OS process command</i></li>
     <li class="is-file">deps <i>Run dependencies (required resources)</i></li>
     <li class="is-file">env <i>Run OS process environment</i></li>
     <li class="is-file">exit_status <i>Run OS process exit status</i></li>
     <li class="is-file">_extra_NAME <i>Extra config for NAME, defined for the model operation</i></li>
     <li class="is-file">flags <i>Flag values used for the run</i></li>
     <li class="is-file">opref <i>Reference to the operation associated with the run</i></li>
     <li class="is-file">started <i>Started timestamp</i></li>
     <li class="is-file">stopped <i>Stopped timestamp</i></li>
   </ul>
 </li>
 </ul>
</li>
</ul>
</div>

## Resource cache

When Guild resolves resources, it uses `GUILD_HOME/cache/resources`
for two purposes:

- Location for downloading URL resource sources
- Location for unpacking archives

Resources are stored in directories that are named using hashes of the
corresponding resource source URI, which is an internal representation
of a resource source location. If a resource exists in the cache, it
is used rather than downloading or unpacking the resource again.

Guild does not remove items from the resource cache.

You may clear the resource cache by deleting
`GUILD_HOME/cache/resources`. Guild commands will continue to function
normally and the cache will be repopulated as needed.

### Resource cache and virtual environments

By default, Guild reuses the resource cache in
`~/.guild/cache/resources` (the user-level resource cache) for all
virtual environments. This means that cached resources available
within virtual environments without having to re-download
files. However, it also means that virtual environments can modify the
user-level resource cache.

If you want to isolate a virtual environment from the user-level
cache, run the following command after you first activate the
environment:

``` command
guild init --local-resource-cache
```

## Runs index

Guild maintains an index of run data in `GUILD_HOME/cache/runs`. This
index lets Guild lookup values such as training accuracy and loss
quickly when performing comparisons.

Guild updates the runs index lazily as it discovers new runs or new
data associated with a run.

You may clear the runs cache by deleting
`GUILD_HOME/cache/runs`. Guild commands will continue to function
normally and runs will be indexed again as needed.
