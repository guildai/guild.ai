<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="keywords" content="">
    <title>Develop a model from scratch - Guild AI</title>
    <link href="../../../assets/css/vendor.min.css" rel="stylesheet">
    <link href="../../../assets/css/theDocs.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Roboto+Slab|Roboto|Roboto+Mono" rel="stylesheet">
    <link rel="icon" href="../../../assets/img/favicon.png">
  </head>
  <body>
    
    



<div class="search-modal modal fade" id="search-modal" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h6 class="modal-title" id="exampleModalLabel">Search</h6>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="input-group">
          <div class="input-wrapper">
            <span class="fa fa-search fa-lg" aria-hidden="true"></span>
            <input
              type="text"
              id="search-input"
              class="form-control initial-focus"
              placeholder="Find something">
          </div>
        </div>
        <ul id="search-results"></ul>
      </div>
      <div class="modal-footer">
        <ul class="pagination" id="search-pages"></ul>
        <div class="algolia-link">
          <a href="https://www.algolia.com/" target="_blank">
            <img src="../../../assets/img/search-by-algolia.svg">
          </a>
        </div>
      </div>
    </div>
  </div>
</div>


<header class="site-header sticky">
  <nav class="navbar navbar-default">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle for-sidebar" data-toggle="offcanvas">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../../">
          <img src="../../../assets/img/logo_nav.svg" alt="logo">
        </a>
      </div>
      <div class="spacer"></div>
      <div id="navbar" class="navbar-collapse collapse" aria-expanded="true" role="banner">
        
        <ul class="nav navbar-nav navbar-right">
  
  
  
  
  
  
  <li class="">
    <a href="/install/">Install</a>
  </li>
  
  
  
  
  <li class="active">
    <a href="/docs/">Documentation</a>
  </li>
  
  
  
  
  <li class="">
    <a href="/models/">Models</a>
  </li>
  
  
  
  
  <li class="">
    <a href="/support/">Support</a>
  </li>
  
  
  
  
  
  
  
  <li class="">
    <a href="/about/">About</a>
  </li>
  
  
</ul>
      </div>
      <div class="search-header">
  <button type="button" class="btn btn-search" data-toggle="modal" data-target="#search-modal">
    <span class="fa fa-search fa-lg" aria-hidden="true"></span>
  </button>
</div>
    </div>
  </nav>
  
</header>

    
<main class="container">
  <div class="row">
    <aside class="col-sm-3 sidebar">

  <div class="sidebar-nav">
    <div>
      <button type="button" class="sidebar-close" data-toggle="offcanvas">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
      </button>
      <a class="sidebar-nav-brand" href="None">
        <img src="../../../assets/img/logo_nav.svg" alt="logo">
      </a>
    </div>
    <ul class="nav ">
  
  
  
  
  
  
  <li class="">
    <a href="/install/">Install</a>
  </li>
  
  
  
  
  <li class="active">
    <a href="/docs/">Documentation</a>
  </li>
  
  
  
  
  <li class="">
    <a href="/models/">Models</a>
  </li>
  
  
  
  
  <li class="">
    <a href="/support/">Support</a>
  </li>
  
  
  
  
  
  
  
  <li class="">
    <a href="/about/">About</a>
  </li>
  
  
</ul>
    <ul class="social-icons">
  
  <li><a href="https://github.com/guildai" target="_blank"><i class="fa fa-github"></i></a></li>
  
  <li><a href="https://twitter.com/guild_ai" target="_blank"><i class="fa fa-twitter"></i></a></li>
  
</ul>
  </div>

  
  
  
  
  
  
  
  <ul class="sidenav dropable sticky_disabled">
    
    
    
    
    <li>
      <a
        class=""
        href="/docs/overview/">Overview</a>
    </li>
    
    
    
    <li>
      <a
        class=""
        href="/docs/models/">Models</a>
    </li>
    
    
    
    <li>
      <a
        class=""
        href="/docs/operations/">Operations</a>
    </li>
    
    
    
    <li>
      <a
        class=""
        href="/docs/runs/">Runs</a>
    </li>
    
    
    
    <li>
      <a
        class=""
        href="/docs/resources/">Resources</a>
    </li>
    
    
    
    <li>
      <a
        class=""
        href="/docs/packages/">Packages</a>
    </li>
    
    
    
    <li>
      <a class="" href="#">Visualization</a>
      <ul>
        
        
        <li>
          <a
            class=""
            href="/docs/visual/guild-view/">Guild View</a>
        </li>
        
        
        
        <li>
          <a
            class=""
            href="/docs/visual/tensorboard/">TensorBoard</a>
        </li>
        
        
      </ul>
    </li>
    
    
    
    <li>
      <a class="" href="#">Commands</a>
      <ul>
        
        
        <li>
          <a
            class=""
            href="/docs/commands/">Overview</a>
        </li>
        
        
        
        <li>
          <a
            class=""
            href="/docs/commands/check-cmd/">check</a>
        </li>
        
        
        
        <li>
          <a
            class=""
            href="/docs/commands/compare-cmd/">compare</a>
        </li>
        
        
        
        <li>
          <a
            class=""
            href="/docs/commands/help-cmd/">help</a>
        </li>
        
        
        
        <li>
          <a
            class=""
            href="/docs/commands/index-cmd/">index</a>
        </li>
        
        
        
        <li>
          <a
            class=""
            href="/docs/commands/init-cmd/">init</a>
        </li>
        
        
        
        <li>
          <a
            class=""
            href="/docs/commands/install-cmd/">install</a>
        </li>
        
        
        
        <li>
          <a
            class=""
            href="/docs/commands/label-cmd/">label</a>
        </li>
        
        
        
        <li>
          <a
            class=""
            href="/docs/commands/models-cmd/">models</a>
        </li>
        
        
        
        <li>
          <a
            class=""
            href="/docs/commands/operations-cmd/">operations</a>
        </li>
        
        
        
        <li>
          <a
            class=""
            href="/docs/commands/package-cmd/">package</a>
        </li>
        
        
        
        <li>
          <a
            class=""
            href="/docs/commands/packages-cmd/">packages</a>
        </li>
        
        
        
        <li>
          <a
            class=""
            href="/docs/commands/packages-delete-cmd/">packages delete</a>
        </li>
        
        
        
        <li>
          <a
            class=""
            href="/docs/commands/packages-info-cmd/">packages info</a>
        </li>
        
        
        
        <li>
          <a
            class=""
            href="/docs/commands/packages-list-cmd/">packages list</a>
        </li>
        
        
        
        <li>
          <a
            class=""
            href="/docs/commands/resources-cmd/">resources</a>
        </li>
        
        
        
        <li>
          <a
            class=""
            href="/docs/commands/run-cmd/">run</a>
        </li>
        
        
        
        <li>
          <a
            class=""
            href="/docs/commands/runs-cmd/">runs</a>
        </li>
        
        
        
        <li>
          <a
            class=""
            href="/docs/commands/runs-delete-cmd/">runs delete</a>
        </li>
        
        
        
        <li>
          <a
            class=""
            href="/docs/commands/runs-info-cmd/">runs info</a>
        </li>
        
        
        
        <li>
          <a
            class=""
            href="/docs/commands/runs-label-cmd/">runs label</a>
        </li>
        
        
        
        <li>
          <a
            class=""
            href="/docs/commands/runs-list-cmd/">runs list</a>
        </li>
        
        
        
        <li>
          <a
            class=""
            href="/docs/commands/runs-purge-cmd/">runs purge</a>
        </li>
        
        
        
        <li>
          <a
            class=""
            href="/docs/commands/runs-restore-cmd/">runs restore</a>
        </li>
        
        
        
        <li>
          <a
            class=""
            href="/docs/commands/runs-stop-cmd/">stop</a>
        </li>
        
        
        
        <li>
          <a
            class=""
            href="/docs/commands/search-cmd/">search</a>
        </li>
        
        
        
        <li>
          <a
            class=""
            href="/docs/commands/shell-cmd/">shell</a>
        </li>
        
        
        
        <li>
          <a
            class=""
            href="/docs/commands/stop-cmd/">stop</a>
        </li>
        
        
        
        <li>
          <a
            class=""
            href="/docs/commands/sync-cmd/">sync</a>
        </li>
        
        
        
        <li>
          <a
            class=""
            href="/docs/commands/tensorboard-cmd/">tensorboard</a>
        </li>
        
        
        
        <li>
          <a
            class=""
            href="/docs/commands/tensorflow-cmd/">tensorflow</a>
        </li>
        
        
        
        <li>
          <a
            class=""
            href="/docs/commands/tensorflow-inspect-cmd/">tensorflow inspect</a>
        </li>
        
        
        
        <li>
          <a
            class=""
            href="/docs/commands/uninstall-cmd/">uninstall</a>
        </li>
        
        
        
        <li>
          <a
            class=""
            href="/docs/commands/view-cmd/">view</a>
        </li>
        
        
      </ul>
    </li>
    
    
    
    <li>
      <a class="" href="#">Reference</a>
      <ul>
        
        
        <li>
          <a
            class=""
            href="/docs/reference/guild-file/">Guild file</a>
        </li>
        
        
        
        <li>
          <a
            class=""
            href="/docs/reference/guild-home/">Guild home</a>
        </li>
        
        
      </ul>
    </li>
    
    
    
    <li>
      <a class="active" href="#">Tutorials</a>
      <ul>
        
        
        <li>
          <a
            class=""
            href="/docs/tutorials/">Overview</a>
        </li>
        
        
        
        <li>
          <a
            class=""
            href="/docs/tutorials/train-mnist/">Go deeper with Guild AI</a>
        </li>
        
        
        
        <li>
          <a
            class=""
            href="/docs/tutorials/train-and-predict-with-cloudml/">Train and predict with Cloud ML</a>
        </li>
        
        
        
        <li>
          <a
            class="active"
            href="/docs/tutorials/develop-a-model-from-scratch/">Develop a model from scratch</a>
        </li>
        
        
        
        <li>
          <a
            class=""
            href="/docs/tutorials/workflow-with-virtualenv/">Workflow with Virtualenv</a>
        </li>
        
        
      </ul>
    </li>
    
    
    
    <li>
      <a
        class=""
        href="/troubleshooting/">Troubleshooting</a>
    </li>
    
    
  </ul>
  
  
  
  
  
  
  
  
  
  
  
</aside>
    <article
      class="col-sm-9 main-content"
      role="main">
      <h1 id="develop-a-model-from-scratch">Develop a model from scratch</h1>
<ol class="toc">
<li><a href="#requirements">Requirements</a></li>
<li><a href="#initialize-a-guild-ai-project">Initialize a Guild AI project</a></li>
<li><a href="#project-guild-file">Project Guild file</a></li>
<li><a href="#train-the-sample-model">Train the sample model</a></li>
<li><a href="#review-the-training-script">Review the training script</a><ol class="md">
<li><a href="#main-function">Main function</a></li>
<li><a href="#parse-command-line-arguments">Parse command line arguments</a></li>
<li><a href="#initialize-the-training-and-test-data">Initialize the training and test data</a></li>
<li><a href="#initialize-the-model">Initialize the model</a></li>
<li><a href="#train-the-model">Train the model</a></li>
<li><a href="#evaluate-the-model">Evaluate the model</a></li>
<li><a href="#main-handler">Main handler</a></li>
</ol>
</li>
<li><a href="#load-the-iris-data">Load the Iris data</a><ol class="md">
<li><a href="#download-iris_datapy">Download iris_data.py</a></li>
<li><a href="#import-iris_data">Import iris_data</a></li>
<li><a href="#modify-init_data">Modify init_data</a></li>
<li><a href="#test-your-changes">Test your changes</a></li>
</ol>
</li>
<li><a href="#define-the-model">Define the model</a></li>
<li><a href="#implement-train-and-evaluate">Implement train and evaluate</a></li>
<li><a href="#delete-the-trial-runs">Delete the trial runs</a></li>
<li><a href="#train-the-dnn">Train the DNN</a></li>
<li><a href="#view-runs">View runs</a></li>
<li><a href="#summary">Summary</a></li>
<li><a href="#next-steps">Next steps</a></li>
</ol>
<p>In this tutorial, we&rsquo;ll develop a model with Guild AI from
scratch. We&rsquo;ll follow this general process:</p>
<ul class="md">
<li>Create a training script skeleton</li>
<li>Implement a model using one of the available TensorFlow model APIs</li>
<li>Obtain a training dataset</li>
<li>Iteratively train, evaluate and improve the model</li>
</ul>
<p>Our final goal is a trained model that predicts classes from the Iris
dataset. We&rsquo;ll use the model architecture outlined in <a class="ext" href="https://www.tensorflow.org/get_started/premade_estimators" target="_blank">Getting Started
with TensorFlow</a>.</p>
<h2 id="requirements">Requirements</h2>
<p>This tutorial assumes the following:</p>
<ul class="md">
<li>Guild AI is <a href="../../../install">installed and verified</a></li>
<li>Your <a href="../../../docs/tutorials/workflow-with-virtualenv/#using-a-virtual-environment">virtual environment is activated</a>
  (if applicable)</li>
<li>You have a working Internet connection</li>
</ul>
<p>While not required, we recommend using a dedicated virtual environment
for this tutorial. To setup your environment, see
<a href="../../../docs/tutorials/#tutorial-virtual-environments">Tutorial virtual environments</a>.</p>
<h2 id="initialize-a-guild-ai-project">Initialize a Guild AI project</h2>
<p>Guild projects are directories that contain a <a class="term" href="../../../docs/reference/guild-file/">Guild
file</a> &mdash; i.e. a file named <code>guild.yml</code>. A Guild file
contains information used to train models.</p>
<p>Let&rsquo;s create a new Guild project for our iris classifier by running:</p>
<pre><code class="language-command">guild init --project iris
</code></pre>

<p>Guild asks you to confirm the operation. Press <code>ENTER</code> to initialize
the new project.</p>
<p>The commands creates a new directory:</p>
<div class="file-tree">
<ul>
<li class="is-folder open">./iris <i>Project directory</i>
 <ul>
 <li class="is-file">guild.yml<i>Guild file</i></li>
 <li class="is-file">train.py<i>Training script</i></li>
</ul>
</li>
</ul>
</div>

<p>Change to the <code>iris</code> directory and run <code>guild help</code>:</p>
<pre><code class="language-command">cd iris
guild help
</code></pre>

<p>The help screen displays information in the Guild file
<code>guild.yml</code>. We&rsquo;ll look more closely at this file next.</p>
<p>Press <code>q</code> to stop viewing the project help.</p>
<h2 id="project-guild-file">Project Guild file</h2>
<p>Guild files are named <code>guild.yml</code> and are located in the project
directory. Guild files contain the information needed to train your
model.</p>
<p>Before we turn our attention to the model training script, let&rsquo;s make
a quick change to <code>guild.yml</code>.</p>
<p>In a text editor, open <code>./iris/guild.yml</code>.</p>
<pre><code class="language-yaml">- model: iris
  description: A basic model.
  operations:
    train:
      description: Train the model.
      cmd: train
      flags:
        train-steps:
          description: Number of steps to train.
          default: 1000
        batch-size:
          description: Training batch size.
          default: 64
</code></pre>

<p>Modify the model <code>description</code> and replace:</p>
<pre><code>A basic model.
</code></pre>
<p>with:</p>
<pre><code>DNN classifier for Iris data.
</code></pre>
<p>Save <code>guild.yml</code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Leave <code>guild.yml</code> open in your text editor &mdash; we&rsquo;ll make changes
to it as we go along. If your text editor is a command line
application, open a <a href="../../../docs/commands/#running-commands-in-a-separate-console">separate console</a> to run commands in.</p>
</div>
<p>From a command line in the <code>./iris</code> project directory, run:</p>
<pre><code class="language-command">guild models
</code></pre>

<p>You should see this output:</p>
<pre><code class="language-output">Limiting models to the current directory (use --all to include all)
./iris  DNN classifier for Iris data
</code></pre>

<p>The message <code>Limiting models to the current directory</code> is displayed
when showing information about models defined in the current
directory. In this case, Guild notices <code>guild.yml</code> and infers you&rsquo;re
working on a project. Rather than show you all of the models available
on the system, it limits the results to models defined in the project.</p>
<p>For the remainder of this tutorial, we&rsquo;ll omit this message from the
expected output for brevity.</p>
<p>Next, list the operations available:</p>
<pre><code class="language-command">guild operations
</code></pre>

<p>Guild displays the operations for our model:</p>
<pre><code class="language-output">./iris:train  Train the model
</code></pre>

<p>All of this information is defined in <code>guild.yml</code>. Over the course of
this tutorial, we&rsquo;ll evolve this file to support all the features of
our Iris classifier.</p>
<h2 id="train-the-sample-model">Train the sample model</h2>
<p>At this point our model is just a sample &mdash; it doesn&rsquo;t train anything
or know about Iris data. However, we can still run the <code>train</code>
operation, which simulates the training process.</p>
<p>From a command line in the <code>./iris</code> directory, run:</p>
<pre><code class="language-command">guild train
</code></pre>

<p>Guild prompts you with this message:</p>
<pre><code class="language-output">You are about to run ./iris:train
  batch-size: 64
  train-steps: 1000
Continue? (Y/n)
</code></pre>

<p>This lets you review the <a class="term" href="../../../docs/operations/#flags">flag values</a> that will be used
for the <code>train</code> operation.</p>
<p>Accept the values and start the training by pressing <code>ENTER</code>.</p>
<p>Guild runs the sample training operation and exits:</p>
<pre><code class="language-output">Sample train: step 0
Sample train: step 100
Sample train: step 200
Sample train: step 300
Sample train: step 400
Sample train: step 500
Sample train: step 600
Sample train: step 700
Sample train: step 800
Sample train: step 900
Sample evaluate: 0.888 accuracy
</code></pre>

<p>While this is only a stub, we did execute a training run. You can list
runs for a project by running:</p>
<pre><code class="language-command">guild runs
</code></pre>

<p>You should see the completed training run.</p>
<p>Guild runs automatically generated when you run <code>train</code>. Each run
contains a record of the operation, which includes information about
the operation along with files generated during the run.</p>
<p>You can show information about the latest run by running:</p>
<pre><code class="language-command">guild runs info
</code></pre>

<p>This shows run details including:</p>
<table class="table dl">
<tr><td class="dt" id="run-id">Run ID</td>
<td class="dd">A unique identifier for the run</td>
</tr><tr><td class="dt" id="run-operation">Run operation</td>
<td class="dd">The model operation that generated the run</td>
</tr><tr><td class="dt" id="start-and-stop-time">Start and stop time</td>
<td class="dd">When the run was started and stopped</td>
</tr><tr><td class="dt" id="run-directory">Run directory</td>
<td class="dd">The file system directory containing run files</td>
</tr><tr><td class="dt" id="command-details">Command details</td>
<td class="dd">The command used to run the operation, its exit status (if it
  exited) and its operation system PID (if it&rsquo;s still running)</td>
</tr></table>
<p>We&rsquo;ll revisit runs later in this tutorial.</p>
<p>Next, we&rsquo;ll review our project&rsquo;s training script.</p>
<h2 id="review-the-training-script">Review the training script</h2>
<p>In your text editor, open <code>./iris/train.py</code>, which is the sample
training script that Guild created when you initialized the project.</p>
<p>Here&rsquo;s the script with imports and comments removed for brevity. We&rsquo;ll
look at each part in turn.</p>
<pre><code class="language-python">def main():
    args = parse_args()
    data = init_data(args)
    model = init_model(data, args)
    train(model, data, args)
    evaluate(model, data, args)

def parse_args():
    parser = argparse.ArgumentParser()
    parser.add_argument('--train-steps', default=1000, type=int)
    parser.add_argument('--batch-size', default=100, type=int)
    parser.add_argument('--data-dir', default='data')
    parser.add_argument('--model-dir', default='model')
    return parser.parse_args()

def init_data(args):
    train_x, train_y = [], []
    test_x, test_y = [], []
    return (train_x, train_y), (test_x, test_y)

def init_model(data, args):
    return 'sample model'

def train(model, data, args):
    for step in range(args.train_steps):
        if step % 100 == 0:
            print('Sample train: step %s' % step)

def evaluate(model, data, args):
    print('Sample evaluate: 0.888 accuracy')

if __name__ == '__main__':
    main()
</code></pre>

<h3 id="main-function">Main function</h3>
<pre><code class="language-python">def main():
    args = parse_args()
    data = init_data(args)
    model = init_model(data, args)
    train(model, data, args)
    evaluate(model, data, args)
</code></pre>

<p>This function orchestrates the training operation:</p>
<ul class="md">
<li>Parse command line arguments</li>
<li>Initialize data used for training and evaluation</li>
<li>Initialize the model</li>
<li>Train the model</li>
<li>Evaluate the model</li>
</ul>
<p>We won&rsquo;t modify this function because it already does what we need.</p>
<h3 id="parse-command-line-arguments">Parse command line arguments</h3>
<pre><code class="language-python">def parse_args():
    parser = argparse.ArgumentParser()
    parser.add_argument('--train-steps', default=1000, type=int)
    parser.add_argument('--batch-size', default=100, type=int)
    parser.add_argument('--data-dir', default='data')
    parser.add_argument('--model-dir', default='model')
    return parser.parse_args()
</code></pre>

<p>This function parses command line arguments passed to the script.</p>
<p>Rather than hard-code hyperparameter values, consider using command
line arguments. This pattern provides a couple of benefits:</p>
<ul class="md">
<li>
<p>Users can experiment with different hyperparameter values without
  modifying source code.</p>
</li>
<li>
<p>By defining hyperparameters as command line arguments, you document
  values that can be changed without compromising the model
  architecture.</p>
</li>
</ul>
<h3 id="initialize-the-training-and-test-data">Initialize the training and test data</h3>
<pre><code class="language-python">def init_data(args):
    train_x, train_y = [], []
    test_x, test_y = [], []
    return (train_x, train_y), (test_x, test_y)
</code></pre>

<p>This function is a stub for loading and initializing data. We&rsquo;ll
modify this function later in this tutorial to load and prepare our
Iris data for training and validation.</p>
<h3 id="initialize-the-model">Initialize the model</h3>
<pre><code class="language-python">def init_model(data, args):
    return 'sample model'
</code></pre>

<p>This function is a stub for initializing the model. We&rsquo;ll modify it
later in this tutorial to return a <code>tf.estimator.DNNClassifier</code> that
can be used to train with the Iris data.</p>
<h3 id="train-the-model">Train the model</h3>
<pre><code class="language-python">def train(model, data, args):
    for step in range(args.train_steps):
        if step % 100 == 0:
            print('Sample train: step %s' % step)
</code></pre>

<p>This function is a stub for the training loop. We&rsquo;ll modify it later
in this tutorial to call the <code>train</code> method of our model.</p>
<h3 id="evaluate-the-model">Evaluate the model</h3>
<pre><code class="language-python">def evaluate(model, data, args):
    print('Sample evaluate: 0.888 accuracy')
</code></pre>

<p>Our final function is a stub for evaluating the trained model. We&rsquo;ll
modify it later in this tutorial to call the <code>evaluate</code> method of our
model.</p>
<h3 id="main-handler">Main handler</h3>
<pre><code class="language-python">if __name__ == &quot;__main__&quot;:
    main()
</code></pre>

<p>This statement calls <code>main</code> only when then module is loaded as a
script.</p>
<p>This pattern serves two purposes:</p>
<ul class="md">
<li>The script can be executed from a command line</li>
<li>The script can also be imported by other Python modules without
  automatically running</li>
</ul>
<p>It&rsquo;s a good idea to use this pattern because it allows your training
script to be used as a module by other Python programs.</p>
<h2 id="load-the-iris-data">Load the Iris data</h2>
<p>Let&rsquo;s start modifying our training script to work with Iris data.</p>
<p>For our project, we&rsquo;ll use the Iris data prepared by Google for
<a class="ext" href="https://www.tensorflow.org/get_started/premade_estimators" target="_blank">Getting Started with TensorFlow</a>.</p>
<h3 id="download-iris_datapy">Download <code>iris_data.py</code></h3>
<p>Download <a class="ext"
href="https://raw.githubusercontent.com/tensorflow/models/079d67d9a0b3407e8d074a200780f3835413ef99/samples/core/get_started/iris_data.py"
download>iris_data.py</a> and save it in your <code>./iris</code> project
directory.</p>
<p>Once you&rsquo;ve saved the file, your project directory should look like this:</p>
<div class="file-tree">
<ul>
<li class="is-folder open">./iris
 <ul>
 <li class="is-file">guild.yml</li>
 <li class="is-file">iris_data.py <i><strong>Newly downloaded file</strong></i></li>
 <li class="is-file">train.py</li>
</ul>
</li>
</ul>
</div>

<h3 id="import-iris_data">Import <code>iris_data</code></h3>
<p>In your text editor, modify <code>./iris/train.py</code> by adding the following
line to the imports section of the file, after the line <code class="lit">import
tensorflow as tf</code>:</p>
<pre><code class="language-python">import iris_data
</code></pre>

<p>Your imports should look like this:</p>
<pre><code class="language-python">import argparse

import tensorflow as tf

import iris_data   # newly added line
</code></pre>

<h3 id="modify-init_data">Modify <code>init_data</code></h3>
<p>Next, we&rsquo;ll modify the <code>init_data</code> function to load the Iris data.</p>
<p>In you text editor, modify <code>./iris/train.py</code> to change the <code>init_data</code>
function to be this:</p>
<pre><code class="language-python">def init_data(_args):
    return iris_data.load_data()
</code></pre>

<p>Note our changes:</p>
<ul class="md">
<li>
<p>We&rsquo;re passing through the call to <code>init_data</code> to our data module
  without making additional changes to the data. Refer to
  <code>iris_data.py</code> for details on how the data is loaded.</p>
</li>
<li>
<p>We&rsquo;re not using the <code>args</code> argument, so we rename it to
  <code>_args</code>. Feel free to remove <code>args</code> altogether, but if you do, you
  must also update the <code>main</code> function to use <code class="lit">init_data()</code>.</p>
</li>
</ul>
<h3 id="test-your-changes">Test your changes</h3>
<p>In your text editor, save your changes.</p>
<p>Our script should now load the Iris data but continue the simulated
training and evaluation without using the data. If we have problems
here we can fix them before continuing to the next steps.</p>
<p>From a command line in the <code>./iris</code> directory, run:</p>
<pre><code class="language-command">guild train -y
</code></pre>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We use the <code class="lit">-y</code> option here to bypass the prompt, saving us
a step.</p>
</div>
<p>Below are some issues you might experience at this point.</p>
<table class="table dl">
<tr><td class="dt"><code>ImportError: No module named iris_data</code></td>
<td class="dd">Verify that you downloaded <code>iris_data.py</code> into the project
  directory. See <a href="#download-iris_datapy">Download iris_data.py</a> above
  for help.</td>
</tr><tr><td class="dt"><code>NameError: global name 'iris_data' is not defined</code></td>
<td class="dd">Ensure that you are importing the <code>iris_data</code> module. See <a href="#import-iris_data">Import
  iris_data </a> above for help.</td>
</tr><tr><td class="dt" id="an-error-originating-from">An error originating from <code>iris_data.py</code></td>
<td class="dd">Verify that you <code>iris_data.py</code> was saved correctly.</td>
</tr></table>
<p>If the command succeeds, you should see the same result as from our
previous run.</p>
<p>You can list the runs by running:</p>
<pre><code class="language-command">guild runs
</code></pre>

<p>Next, we&rsquo;ll define our model.</p>
<h2 id="define-the-model">Define the model</h2>
<p>In this step, we&rsquo;ll implement a simple deep neural network as
described in <a class="ext" href="https://www.tensorflow.org/get_started/premade_estimators#instantiate_an_estimator" target="_blank">Getting Started with TensorFlow - Instantiate an
estimator</a>.</p>
<p>In your text editor, modify <code>./iris/train.py</code> and change the
<code>init_model</code> function to be this:</p>
<pre><code class="language-python">def init_model(data, args):
    train_x = data[0][0]
    feature_columns = [
        tf.feature_column.numeric_column(key=key)
        for key in train_x.keys()
    ]
    return tf.estimator.DNNClassifier(
        feature_columns=feature_columns,
        hidden_units=[10, 10],
        n_classes=3,
        model_dir=args.model_dir)
</code></pre>

<p>This is the most complex change to our script, so let&rsquo;s take a moment
to understand it.</p>
<p>The purpose of <code>init_model</code> is to return something that can be trained
and evaluated. In this case, we&rsquo;re using the <a class="ext" href="https://www.tensorflow.org/programmers_guide/estimators" target="_blank">TensorFlow Estimators</a>
high-level framework to create a DNN classifier.</p>
<p>The classifier requires a list of feature columns, which we provide
from the training data.</p>
<p>We also specify <code>model_dir</code>, which tells TensorFlow to generate logs
and save the trained model during training. We&rsquo;ll see this in action
later.</p>
<p>In your text editor, save your changes.</p>
<p>Feel free to stop now and test your changes by running:</p>
<pre><code class="language-command">guild train -y
</code></pre>

<p>While we&rsquo;re still not yet training our model, you will see additional
output from the command, which is generated by TensorFlow when we
instantiate the model.</p>
<h2 id="implement-train-and-evaluate">Implement train and evaluate</h2>
<p>In this step, we&rsquo;ll modify our <code>train</code> and <code>evaluate</code> functions to
perform real work!</p>
<p>In your text editor, modify <code>./iris/train.py</code> and change the <code>train</code>
function to be:</p>
<pre><code class="language-python">def train(model, data, args):
    (train_x, train_y), _ = data
    input_fn = lambda: iris_data.train_input_fn(
        train_x, train_y, args.batch_size)
    model.train(input_fn=input_fn, steps=args.train_steps)

</code></pre>

<p>Next, change the <code>evaluate</code> function to be:</p>
<pre><code class="language-python">def evaluate(model, data, args):
    _, (test_x, test_y) = data
    input_fn = lambda: iris_data.eval_input_fn(
        test_x, test_y, args.batch_size)
    eval_result = model.evaluate(input_fn=input_fn)
    print('Test set accuracy: {accuracy:0.3f}\n'.format(**eval_result))
</code></pre>

<p>Both functions are similar:</p>
<ul class="md">
<li>
<p>They both call a single method on <code>model</code> to perform the work.</p>
</li>
<li>
<p>The both use a callback <code>input_fn</code> to read batched data.</p>
</li>
</ul>
<p>Note that we&rsquo;re using <code>args.batch_size</code> rather than hard-coding a
value. This makes it easy to experiment with different values without
changing the source code.</p>
<p>In your text editor, save your changes.</p>
<p>At this point our training script is ready to train the Iris data!</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you&rsquo;d like, feel free to delete any remaining <code>TODO</code>
comments.</p>
</div>
<h2 id="delete-the-trial-runs">Delete the trial runs</h2>
<p>Before we proceed, let&rsquo;s delete all of our runs up to this point,
which we won&rsquo;t use because they were just trials. From a command line,
run:</p>
<pre><code class="language-command">guild runs delete
</code></pre>

<p>Guild will ask you to confirm the operation before proceeding. Press
<code>ENTER</code> to delete the runs.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Guild lets you restore deleted runs using the <a class="cmd" href="../../../docs/commands/runs-restore-cmd">runs
restore</a> command. This can come in handy if you
accidentally delete something you need!</p>
</div>
<h2 id="train-the-dnn">Train the DNN</h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The full source code to the project at this point can be found here:</p>
<ul class="md">
<li><a href="https://github.com/guildai/examples/tree/master/iris">https://github.com/guildai/examples/tree/master/iris</a></li>
</ul>
</div>
<p>Train our new DNN by running:</p>
<pre><code class="language-command">guild train -y
</code></pre>

<p>You should see real training progress this time, with updates from
TensorFlow about training loss and other training statistics.</p>
<p>When the training is completed, the script prints a final accuracy,
which is calculated using test data. It should be 0.967.</p>
<p>Congratulations - you&rsquo;ve just trained a classifier for Iris data!</p>
<h2 id="view-runs">View runs</h2>
<p>From a command line, run:</p>
<pre><code class="language-command">guild view
</code></pre>

<p>This command opens Guild View in a browser. Use Guild View to explore
your run(s). Click <img alt="View in
TensorBoard" class="md" src="../../../assets/img/view-in-tensorboard.png" /> in the upper-right
of the page to view your runs in TensorBoard.</p>
<p>Click the <strong>FILES</strong> tab to view the files generated by the
operation. These include TensorFlow event logs, which are used by
TensorBoard, and the saved trained model.</p>
<p>You can list the files associated with the latest run by running:</p>
<pre><code class="language-command">guild runs info --files
</code></pre>

<p>To see the full path to each file &mdash; for example, to reference the
file in another command &mdash; use the <code>-P</code> option:</p>
<pre><code class="language-command">guild runs info --files -P
</code></pre>

<h2 id="summary">Summary</h2>
<p>In this tutorial, we developed a new Guild AI project from scratch,
containing the DNN Iris data classifier defined in <a class="ext" href="https://www.tensorflow.org/get_started/premade_estimators" target="_blank">Getting Started
with TensorFlow</a>.</p>
<p>In this tutorial, we saw the following:</p>
<ul class="md">
<li>
<p>Guild files (<code>guild.yml</code>) define models that can be trained.</p>
</li>
<li>
<p>Model operations are wrappers for commands to Python modules.</p>
</li>
<li>
<p>Operation flags are passed through to training scripts as command
  line arguments.</p>
</li>
<li>
<p>Guild automatically tracks each run.</p>
</li>
<li>
<p>Guild provides tools to help you evaluate runs, including
  integration with TensorBoard.</p>
</li>
</ul>
<h2 id="next-steps">Next steps</h2>
<ul class="md">
<li><a href="../../../docs">Browse Guild AI documentation</a></li>
</ul>
      
<ul class="pager">
  
  <li class="previous">
    <a href="/docs/tutorials/train-and-predict-with-cloudml/">
      <span>Prev</span> <aside>Train and predict with Cloud ML</aside>
    </a>
  </li>
  
  
  <li class="next">
    <a href="/docs/tutorials/workflow-with-virtualenv/">
      <span>Next</span> <aside>Workflow with Virtualenv</aside>
    </a>
  </li>
  
</ul>

    </article>
  </div>
</main>

    
<footer class="site-footer">
  <div class="container">
    <a id="scroll-up" href="#"><i class="fa fa-angle-up"></i></a>
    <div class="row">
      <div class="col-md-6 col-sm-6 footer-cell">
        <div class="copyright">Copyright &copy; 2017-2018 TensorHub, Inc.</div>
        
      </div>
      <div class="col-md-6 col-sm-6 footer-cell">
        <ul class="footer-menu">
          <li><a href="mailto:niceperson@guild.ai">Contact us</a></li>
        </ul>
      </div>
    </div>
  </div>
</footer>

  </body>
  <script src="../../../assets/js/vendor.min.js" data-manual></script>
  <script src="../../../assets/js/theDocs.min.js"></script>
</html>